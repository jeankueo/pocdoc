<!DOCTYPE html>
<html>
<head>
<meta http-equiv='X-UA-Compatible' content='IE=edge' />
<title>Viz Pipeline PoC</title>

<link rel="stylesheet" href="../bower_components/openui5-themelib_sap_bluecrystal/resources/sap/ui/core/themes/sap_bluecrystal/library.css">
<link rel="stylesheet" href="../bower_components/openui5-themelib_sap_bluecrystal/resources/sap/m/themes/sap_bluecrystal/library.css">
<link rel="stylesheet" href="./control/style.css">
<link rel="stylesheet" href="./view/style.css">

<script id='sap-ui-bootstrap'
	src='../bower_components/openui5-sap.ui.core/resources/sap-ui-core.js'
	data-sap-ui-theme='sap_bluecrystal'
	data-sap-ui-libs='sap.m'
	data-sap-ui-compatVersion='edge'
	data-sap-ui-preload='async'
	data-sap-ui-resourceroots='{
		"sap.m": "../bower_components/openui5-sap.m/resources/sap/m",
		"sap.ciconnect.view": "./view",
		"sap.ciconnect.control": "./control"
	}'>
</script>

<script>
	sap.ui.getCore().attachInit(function () {
		
		registerIcons();
		loadData(composeViews());
		
		function loadData (oApp) {
			var oModel;
			
			oModel = new sap.ui.model.json.JSONModel();
			oModel.loadData("../data/pipeline.json");
			oApp.setModel(oModel, "pipeline");

			oModel = new sap.ui.model.json.JSONModel();
			oModel.loadData("../data/githubrepo.json");
			oApp.setModel(oModel, "github");

			oModel = new sap.ui.model.json.JSONModel();
			oModel.loadData("../data/gitrepo.json");
			oApp.setModel(oModel, "git");
			
			oModel = new sap.ui.model.json.JSONModel();
			oModel.setData({
				"jobStyle": "CircleWithTextAbove",
				"enableConnection": true,
				"enableText": true,
				"enableTwoRow": false
			});
			oApp.setModel(oModel, "setting");
		};
		
		function composeViews () {
			var oPipelinesView = sap.ui.view({
				id:"pipelines",
				viewName:"sap.ciconnect.view.pipelines",
				type:sap.ui.core.mvc.ViewType.XML
			});
			
			var oRepositoryView = sap.ui.view({
				id:"repositories",
				viewName:"sap.ciconnect.view.repositories",
				type:sap.ui.core.mvc.ViewType.XML
			});
			
			var oSummaryView = sap.ui.view({
				id:"summary",
				viewName:"sap.ciconnect.view.summary",
				type:sap.ui.core.mvc.ViewType.XML
			});
			
			var oIconTabBar = new sap.m.IconTabBar({
				stretchContentHeight: true,
				backgroundDesign: "Transparent",
				applyContentPadding: false,
				items: [new sap.m.IconTabFilter({
					text: "Pipelines",
					icon: "sap-icon://awesome/fa-pied-piper-pp",
					count: "{= ${pipeline>/}.length}",
					content: oPipelinesView
				}), new sap.m.IconTabFilter({
					text: "Repositories",
					icon: "sap-icon://oct/octicon-repo",
					count: "{= ${github>/}.length + ${git>/}.length}",
					content: oRepositoryView
				}), new sap.m.IconTabFilter({
					text: "Summary",
					icon: "sap-icon://kpi-corporate-performance",
					content: oSummaryView
				})]
			}).addStyleClass("sapUiResponsiveContentPadding"); 
			
			var oPage = new sap.m.Page({
				id: "ciconnect",
				title: "CI-Connect PoC",
				content: oIconTabBar,
				footer: new sap.m.Toolbar({
					content: [new sap.m.ToolbarSpacer(), new sap.m.Switch({
						customTextOff: "TWO",
						customTextOn: "TWO",
						state: "{setting>/enableTwoRow}"
					}),new sap.m.Switch({
						customTextOff: "TXT",
						customTextOn: "TXT",
						state: "{setting>/enableText}"
					}), new sap.m.Switch({
						customTextOff: "CON",
						customTextOn: "CON",
						state: "{setting>/enableConnection}"
					}), new sap.m.SegmentedButton({
						items: [new sap.m.SegmentedButtonItem({
							text: "Sharp Chevron",
							key: "ChevronWithTextAbove"
						}), new sap.m.SegmentedButtonItem({
							text: "Round Chevron",
							key: "RoundChevronWithTextAbove"
						}), new sap.m.SegmentedButtonItem({
							text: "Pipe",
							key: "PipeWithTextAbove"
						}), new sap.m.SegmentedButtonItem({
							text: "Circle",
							key: "CircleWithTextAbove"
						})],
						selectedKey: "{setting>/jobStyle}",
						select: function (oEvent) {
							oEvent.getSource().getModel("setting").setProperty("/jobStyle", oEvent.getParameter("key"));
						}
					})]
				})
			});
			
			var oApp = new sap.m.App({initialPage:"ciconnect"});
			oApp.addPage(oPage);
			oApp.placeAt("content");
			
			return oApp;
		};
		
		function registerIcons () {
			jQuery.sap.require("sap.ui.core.IconPool");
			registerPerLib({
				fontFamily: "oct",
				collectionName: "oct",
				icons : [
					["octicon-repo-forked", "f002"], ["octicon-repo", "f001"], 
					["octicon-octoface", "f008"], ["octicon-mark-github", "f00a"],
					["octicon-shield", "f0e1"]
				]
			});
			
			registerPerLib({
				fontFamily: "awesome",
				collectionName: "awesome",
				icons : [
					["fa-git-square", "f1d2"], ["fa-pied-piper-pp", "f1a7"]
				]
			});
		};
		
		function registerPerLib (oIcons) {
			for (var i = 0; i < oIcons.icons.length; i++) {
				sap.ui.core.IconPool.addIcon(
					oIcons.icons[i][0], 
					oIcons.collectionName, 
					oIcons.fontFamily, 
					oIcons.icons[i][1],
					false,
					true);
			}
		};
	});
</script>

</head>
<body class='sapUiBody'>
	<div id='content'></div>
</body>
</html>